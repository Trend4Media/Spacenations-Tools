<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>üïµÔ∏è Spacenations Spy Database</title>
    <meta name="description" content="Advanced spy intelligence database for Spacenations strategy game. Track players, planets, buildings, and military units.">
    <meta name="cache-bust" content="v24&force=5">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Gaming Dark Theme */
            --background: hsl(217, 33%, 8%);
            --foreground: hsl(185, 100%, 85%);
            --card: hsl(217, 33%, 10%);
            --card-foreground: hsl(185, 100%, 88%);
            --primary: hsl(184, 100%, 40%);
            --primary-foreground: hsl(217, 33%, 8%);
            --secondary: hsl(217, 33%, 15%);
            --secondary-foreground: hsl(185, 100%, 85%);
            --muted: hsl(217, 33%, 12%);
            --muted-foreground: hsl(185, 30%, 65%);
            --accent: hsl(184, 100%, 35%);
            --border: hsl(217, 33%, 18%);
            --input: hsl(217, 33%, 18%);
            --success: hsl(142, 76%, 36%);
            --warning: hsl(43, 89%, 55%);
            --danger: hsl(0, 72%, 51%);
            --gaming-cyan: hsl(184, 100%, 40%);
            --gaming-cyan-light: hsl(184, 100%, 60%);
            --gaming-success: hsl(142, 76%, 36%);
            --gaming-warning: hsl(43, 89%, 55%);
            --table-header: hsl(217, 33%, 12%);
            --table-row: hsl(217, 33%, 10%);
            --table-row-hover: hsl(217, 33%, 15%);
            --sidebar-bg: hsl(217, 33%, 6%);
        }

        body {
            font-family: 'Courier New', monospace;
            background-color: var(--background);
            color: var(--foreground);
            height: 100vh;
            overflow: hidden;
        }

        .dashboard {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-bottom {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            color: var(--foreground);
        }

        .header-buttons {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--foreground);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--secondary);
        }

        .btn-primary {
            background: var(--primary);
            color: var(--primary-foreground);
            box-shadow: 0 0 10px hsla(184, 100%, 40%, 0.3);
        }

        .btn-success {
            background: var(--gaming-success);
            color: white;
            box-shadow: 0 0 10px hsla(142, 76%, 36%, 0.3);
        }

        .btn-success:hover {
            background: hsl(142, 76%, 30%);
        }

        .status-badge {
            background: var(--gaming-success);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            box-shadow: 0 0 8px hsla(142, 76%, 36%, 0.4);
        }

        .content {
            flex: 1;
            padding: 16px;
            overflow: auto;
        }

        .search-container {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .search-label {
            font-size: 11px;
            color: var(--muted-foreground);
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            font-size: 11px;
            color: var(--muted-foreground);
            margin-bottom: 4px;
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            background: var(--input);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--foreground);
            font-family: inherit;
            font-size: 14px;
        }

        .form-input::placeholder {
            color: var(--muted-foreground);
        }

        .button-group {
            display: flex;
            gap: 8px;
        }

        .btn-full {
            width: 100%;
        }

        .btn-flex {
            flex: 1;
        }

        .stats-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .stats-label {
            font-size: 11px;
            color: var(--muted-foreground);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stats-value {
            font-size: 14px;
            font-weight: bold;
            color: var(--gaming-cyan);
        }

        .table-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .table th {
            background: var(--table-header);
            padding: 12px 8px;
            text-align: center;
            font-family: 'Arial', 'Helvetica', sans-serif;
            font-size: 12px;
            font-weight: 700;
            color: var(--muted-foreground);
            border-right: 1px solid var(--border);
            white-space: nowrap;
            min-width: 60px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .table td {
            padding: 12px 8px;
            text-align: center;
            border-right: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            font-family: 'Arial', 'Helvetica', sans-serif;
            font-size: 13px;
        }

        .table tr:nth-child(even) {
            background: var(--table-row);
        }

        .table tr:hover {
            background: var(--table-row-hover);
        }

        .header-rotated {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            height: 140px;
            min-width: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Arial', 'Helvetica', sans-serif;
            font-size: 13px;
            font-weight: 700;
            line-height: 1.3;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .player-name {
            color: var(--gaming-cyan);
            font-weight: bold;
        }

        .coordinates {
            color: var(--gaming-cyan);
            font-family: 'Courier New', monospace;
        }

        .alliance {
            color: var(--gaming-cyan);
            font-weight: bold;
        }

        .building-value {
            color: var(--gaming-cyan-light);
            font-weight: bold;
        }

        .unit-value {
            color: var(--gaming-warning);
            font-weight: bold;
        }

        .research-value {
            color: var(--muted-foreground);
            font-family: 'Courier New', monospace;
        }

        .copy-btn {
            padding: 4px 8px;
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--foreground);
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            box-shadow: 0 0 10px hsla(184, 100%, 40%, 0.3);
        }

        .copy-btn:hover {
            background: var(--secondary);
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: var(--muted-foreground);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--muted-foreground);
        }

        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-top">
                    <div class="header-left">
                        <h1 class="title">üïµÔ∏è Spy Database</h1>
                        <div class="header-buttons">
                            <button class="btn btn-primary" onclick="addNewReport()">
                                ‚ûï Neuer Bericht
                            </button>
                            <button class="btn" onclick="retryFirebaseConnection()" id="retry-btn" style="display: none;">
                                üîÑ Firebase retry
                            </button>
                            <button class="btn" onclick="goToDashboard()">
                                ‚Üê Dashboard
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="header-bottom">
                    <div class="search-container">
                        <div class="search-group">
                            <label class="search-label">Spieler suchen:</label>
                            <input type="text" class="form-input" placeholder="Spielername eingeben..." id="playerSearch" style="width: 200px;">
                        </div>
                        <div class="search-group">
                            <label class="search-label">Planet suchen:</label>
                            <input type="text" class="form-input" placeholder="Planetenname eingeben..." id="planetSearch" style="width: 200px;">
                        </div>
                        <div class="search-group">
                            <label class="search-label">Spy-Bericht hinzuf√ºgen:</label>
                            <input type="text" class="form-input" placeholder="Spy-Bericht-Link einf√ºgen..." id="spyReportInput" style="width: 300px;">
                            <button class="btn btn-success" onclick="addSpyReport()" style="margin-left: 8px;">
                                ‚ûï Hinzuf√ºgen
                            </button>
                        </div>
                        <button class="btn btn-primary" onclick="performSearch()">
                            üîç Suchen
                        </button>
                        <button class="btn" onclick="clearSearch()">
                            üóëÔ∏è Leeren
                        </button>
                        <button class="btn" onclick="refreshData()">
                            üìä Aktualisieren
                        </button>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="content">
                <div class="table-container">
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>SPIELER</th>
                                    <th>PLANET</th>
                                    <th>KOORDINATEN</th>
                                    <th>ALLIANZ</th>
                                    <th><div class="header-rotated">PLANETENZENTRALE</div></th>
                                    <th><div class="header-rotated">RAUMHAFEN</div></th>
                                    <th><div class="header-rotated">EISENMINE</div></th>
                                    <th><div class="header-rotated">SILIZIUMRAFFINERIE</div></th>
                                    <th><div class="header-rotated">KOHLENSTOFF<br>GEWINNUNGSANLAGE</div></th>
                                    <th><div class="header-rotated">SCHIFFSFABRIK</div></th>
                                    <th><div class="header-rotated">WAFFENFABRIK</div></th>
                                    <th><div class="header-rotated">FORSCHUNGSZENTRUM</div></th>
                                    <th><div class="header-rotated">FORSCHUNG</div></th>
                                    <th><div class="header-rotated">SPIONAGEEINHEIT</div></th>
                                    <th><div class="header-rotated">TARNEINHEIT</div></th>
                                    <th><div class="header-rotated">INVASIONSEINHEIT</div></th>
                                    <th><div class="header-rotated">PL√úNDEREINHEIT</div></th>
                                    <th><div class="header-rotated">SABOTAGE<br>EINHEIT</div></th>
                                    <th>DATUM</th>
                                    <th>LINK</th>
                                </tr>
                            </thead>
                            <tbody id="dataTable">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Message (bottom) -->
        <div id="status-message" style="position: fixed; bottom: 20px; right: 20px; background: var(--gaming-success); color: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; display: none;">
            ‚úÖ Echte Daten geladen! Firebase-Verbindung erfolgreich.
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="js/firebase-config.js?v=12&t=1734567895&force=1"></script>
    <script src="js/session-manager.js?v=1&t=1734567895"></script>
    <script src="js/auth-manager.js?v=1&t=1734567895"></script>
    <script src="js/firebase-sync.js?v=1&t=1734567895"></script>
    <script src="js/spy-report-parser.js?v=3&t=1734567895"></script>
    <script src="js/spy-database-manager.js?v=16&t=1734567895"></script>

    <script>
        // Global variables
        let currentReports = [];
        let currentStatistics = {};
        let filteredReports = [];

        // Force cache refresh
        if ('caches' in window) {
            caches.keys().then(function(names) {
                for (let name of names) {
                    caches.delete(name);
                }
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üïµÔ∏è Spy Database Grid initialisiert - Version v24');
            
            // Load demo data immediately
            console.log('üöÄ Lade sofort Demo-Daten...');
            currentReports = getDemoReports();
            filteredReports = [...currentReports];
            await displayReports(currentReports);
            currentStatistics = getDemoStatistics();
            displayStatistics(currentStatistics);
            showMessage('üöÄ Spy-Datenbank geladen! Demo-Modus aktiv. Versuche Firebase-Verbindung...', 'info');
            
            // Show retry button
            document.getElementById('retry-btn').style.display = 'inline-flex';
            
            // Try Firebase connection in background
            setTimeout(async () => {
                try {
                    const firebaseReady = await waitForFirebaseQuick();
                    if (firebaseReady) {
                        console.log('üî• Firebase verbunden! Lade echte Daten...');
                        await loadReports();
                        
                        // Hide retry button when real data is loaded
                        document.getElementById('retry-btn').style.display = 'none';
                        showMessage('‚úÖ Echte Daten geladen! Firebase-Verbindung erfolgreich.', 'success');
                    } else {
                        console.log('‚ö†Ô∏è Firebase nicht verf√ºgbar, bleibe im Demo-Modus');
                        showMessage('Demo-Modus: Firebase nicht verf√ºgbar. Zeige Beispieldaten. Sie k√∂nnen trotzdem alle Funktionen nutzen!', 'info');
                    }
                } catch (error) {
                    console.log('‚ö†Ô∏è Firebase-Verbindung fehlgeschlagen, bleibe im Demo-Modus:', error.message);
                    showMessage('Demo-Modus: Firebase-Verbindung fehlgeschlagen. Zeige Beispieldaten. Sie k√∂nnen trotzdem alle Funktionen nutzen!', 'info');
                }
            }, 1000);
        });

        // Demo data for offline mode
        function getDemoReports() {
            return [
                {
                    id: 'demo-1',
                    player: 'AstraX',
                    planet: 'Vega Prime',
                    coordinates: '[2:144:7]',
                    alliance: 'NOVA',
                    planetenzentrale: 12,
                    raumhafen: 9,
                    eisenmine: 18,
                    siliziumraffinerie: 16,
                    kohlenstoffgewinnungsanlage: 15,
                    schiffsfabrik: 10,
                    waffenfabrik: 8,
                    forschungszentrum: 11,
                    spionageeinheit: 20,
                    tarneinheit: 5,
                    invasionseinheit: 2,
                    pluendereinheit: 7,
                    sabotageeinheit: 1,
                    datum: '12.9.2025',
                    originalUrl: 'https://example.com/report/1'
                },
                {
                    id: 'demo-2',
                    player: 'NexusCommander',
                    planet: 'Alpha Centauri',
                    coordinates: '[3:201:12]',
                    alliance: 'STELLAR',
                    planetenzentrale: 20,
                    raumhafen: 18,
                    eisenmine: 22,
                    siliziumraffinerie: 19,
                    kohlenstoffgewinnungsanlage: 17,
                    schiffsfabrik: 15,
                    waffenfabrik: 12,
                    forschungszentrum: 25,
                    spionageeinheit: 8,
                    tarneinheit: 6,
                    invasionseinheit: 7,
                    pluendereinheit: 5,
                    sabotageeinheit: 4,
                    datum: '11.9.2025',
                    originalUrl: 'https://example.com/report/2'
                }
            ];
        }

        function getDemoStatistics() {
            return {
                totalReports: 2,
                uniquePlayers: 2,
                uniquePlanets: 2,
                totalAttack: 40000,
                researchLevel: 5,
                buildingLevel: 16
            };
        }

        // Display reports in table
        async function displayReports(reports) {
            const tbody = document.getElementById('dataTable');
            
            if (reports.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="20" class="empty-state">
                            <p>Keine Berichte gefunden</p>
                            <small style="color: var(--muted-foreground);">Firebase nicht verf√ºgbar oder keine Daten</small>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = reports.map(report => {
                // Extrahiere Werte aus der Firebase-Struktur
                const playerName = report.playerName || report.player?.name || report.player || '‚Äî';
                const planetName = report.planetName || report.planet?.name || report.planet || '‚Äî';
                const coordinates = report.planetCoordinates || report.planet?.coordinates || report.coordinates || '‚Äî';
                const alliance = report.player?.allianceName || report.alliance || '‚Äî';
                
                // Geb√§ude aus buildings Object oder legacy fields
                const buildings = report.buildings || {};
                const planetenzentrale = buildings.PZ || report.planetenzentrale || '‚Äî';
                const raumhafen = buildings.RH || report.raumhafen || '‚Äî';
                const eisenmine = buildings.Fe || report.eisenmine || '‚Äî';
                const siliziumraffinerie = buildings.Si || report.siliziumraffinerie || '‚Äî';
                const kohlenstoffgewinnungsanlage = buildings.C || report.kohlenstoffgewinnungsanlage || '‚Äî';
                const schiffsfabrik = buildings.SF || report.schiffsfabrik || '‚Äî';
                const waffenfabrik = buildings.WF || report.waffenfabrik || '‚Äî';
                const forschungszentrum = buildings.FZ || report.forschungszentrum || '‚Äî';
                
                // Forschung/Einheiten aus research Object oder legacy fields
                const research = report.research || {};
                const spionageeinheit = research.spio || report.spionageeinheit || '‚Äî';
                const tarneinheit = research.tarn || report.tarneinheit || '‚Äî';
                const invasionseinheit = research.inva || report.invasionseinheit || '‚Äî';
                const pluendereinheit = research.raid || report.pluendereinheit || '‚Äî';
                const sabotageeinheit = research.sabo || report.sabotageeinheit || '‚Äî';
                
                // Datum formatieren
                let datum = '‚Äî';
                if (report.createdAt) {
                    const date = report.createdAt.toDate ? report.createdAt.toDate() : new Date(report.createdAt);
                    datum = date.toLocaleDateString('de-DE');
                } else if (report.timestamp) {
                    const date = new Date(report.timestamp);
                    datum = date.toLocaleDateString('de-DE');
                } else if (report.datum) {
                    datum = report.datum;
                }
                
                return `
                    <tr>
                        <td class="player-name">${playerName}</td>
                        <td>${planetName}</td>
                        <td class="coordinates">${coordinates}</td>
                        <td class="alliance">${alliance}</td>
                        <td class="building-value">${planetenzentrale}</td>
                        <td class="building-value">${raumhafen}</td>
                        <td class="building-value">${eisenmine}</td>
                        <td class="building-value">${siliziumraffinerie}</td>
                        <td class="building-value">${kohlenstoffgewinnungsanlage}</td>
                        <td class="building-value">${schiffsfabrik}</td>
                        <td class="building-value">${waffenfabrik}</td>
                        <td class="building-value">${forschungszentrum}</td>
                        <td class="research-value">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</td>
                        <td class="unit-value">${spionageeinheit}</td>
                        <td class="unit-value">${tarneinheit}</td>
                        <td class="unit-value">${invasionseinheit}</td>
                        <td class="unit-value">${pluendereinheit}</td>
                        <td class="unit-value">${sabotageeinheit}</td>
                        <td>${datum}</td>
                        <td>
                            ${report.originalUrl ? 
                                `<button class="copy-btn" onclick="copyToClipboard('${coordinates}')">üìã</button>` : 
                                '‚Äî'
                            }
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Display statistics (simplified)
        function displayStatistics(stats) {
            // Statistics display removed - no longer needed
            console.log('üìä Statistiken geladen:', stats);
        }

        // Search functionality
        function performSearch() {
            const playerSearch = document.getElementById('playerSearch').value.toLowerCase();
            const planetSearch = document.getElementById('planetSearch').value.toLowerCase();

            filteredReports = currentReports.filter(report => 
                report.player.toLowerCase().includes(playerSearch) ||
                report.planet.toLowerCase().includes(planetSearch) ||
                (report.alliance && report.alliance.toLowerCase().includes(playerSearch))
            );

            displayReports(filteredReports);
        }

        function clearSearch() {
            document.getElementById('playerSearch').value = '';
            document.getElementById('planetSearch').value = '';
            filteredReports = [...currentReports];
            displayReports(filteredReports);
        }

        async function addSpyReport() {
            const spyReportInput = document.getElementById('spyReportInput');
            const spyReportLink = spyReportInput.value.trim();
            
            if (!spyReportLink) {
                alert('Bitte geben Sie einen Spy-Bericht-Link ein!');
                return;
            }
            
            // Validiere URL
            if (!window.SpyReportAPI || !window.SpyReportAPI.isValidUrl(spyReportLink)) {
                showMessage('‚ùå Ung√ºltige Spy-Report URL. Bitte √ºberpr√ºfen Sie die URL.', 'error');
                return;
            }
            
            // Zeige Loading-State
            const addButton = document.querySelector('button[onclick*="addSpyReport"]');
            const originalText = addButton ? addButton.innerHTML : '';
            if (addButton) {
                addButton.disabled = true;
                addButton.innerHTML = '‚è≥ Verarbeite...';
            }
            
            try {
                console.log('üîç Verarbeite Spy-Bericht:', spyReportLink);
                showMessage('üîÑ Lade und parse Spy-Report Daten...', 'info');
                
                // 1. Parse Spy-Report von API
                const reportData = await window.SpyReportAPI.processUrl(spyReportLink);
                console.log('‚úÖ Spy-Report geparst:', reportData);
                
                // 2. Pr√ºfe ob Report bereits existiert
                const exists = await window.SpyDatabaseAPI.reportExists(reportData.reportId);
                if (exists) {
                    showMessage('‚ö†Ô∏è Dieser Spy-Report wurde bereits hinzugef√ºgt!', 'info');
                    spyReportInput.value = '';
                    if (addButton) {
                        addButton.disabled = false;
                        addButton.innerHTML = originalText;
                    }
                    return;
                }
                
                // 3. Speichere in Firebase
                showMessage('üíæ Speichere Spy-Report in Datenbank...', 'info');
                const docId = await window.SpyDatabaseAPI.saveReport(reportData);
                console.log('‚úÖ Spy-Report in Firebase gespeichert:', docId);
                
                // 4. Lade Reports neu
                await loadReports();
                
                // 5. Erfolgsmeldung
                spyReportInput.value = '';
                showMessage(`‚úÖ Spy-Report erfolgreich hinzugef√ºgt! Spieler: ${reportData.player.name}, Planet: ${reportData.planet.name}`, 'success');
                
                console.log('‚úÖ Spy-Bericht erfolgreich verarbeitet und gespeichert');
                
            } catch (error) {
                console.error('‚ùå Fehler beim Hinzuf√ºgen des Spy-Berichts:', error);
                showMessage(`‚ùå Fehler: ${error.message}`, 'error');
            } finally {
                // Reset Button
                if (addButton) {
                    addButton.disabled = false;
                    addButton.innerHTML = originalText;
                }
            }
        }

        function showStatusMessage(message, type = 'info') {
            // Verwende die bestehende showMessage Funktion
            showMessage(message, type);
        }

        function refreshData() {
            console.log('Refreshing data...');
            loadReports();
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                console.log('Copied to clipboard:', text);
                showMessage(`Koordinaten ${text} in Zwischenablage kopiert!`, 'success');
            });
        }

        function addNewReport() {
            showMessage('Neuer Bericht Funktion wird implementiert...', 'info');
        }

        function goToDashboard() {
            window.location.href = 'user-dashboard.html';
        }

        async function retryFirebaseConnection() {
            console.log('Retrying Firebase connection...');
            try {
                await loadReports();
                showMessage('Firebase-Verbindung erfolgreich!', 'success');
            } catch (error) {
                showMessage('Firebase-Verbindung fehlgeschlagen. Bleibe im Demo-Modus.', 'info');
            }
        }

        // Firebase functions (simplified)
        async function waitForFirebaseQuick() {
            try {
                if (window.FirebaseConfig && window.FirebaseConfig.isReady()) {
                    return true;
                }
                return false;
            } catch (error) {
                return false;
            }
        }

        async function loadReports() {
            try {
                console.log('üìã Lade Spy-Reports...');
                
                if (window.SpyDatabaseAPI) {
                    const reports = await window.SpyDatabaseAPI.getAllianceReports();
                    if (reports.length > 0) {
                        currentReports = reports;
                        filteredReports = [...currentReports];
                        await displayReports(currentReports);
                        await loadStatistics();
                        console.log(`‚úÖ ${currentReports.length} Spy-Reports geladen`);
                        return;
                    }
                }
                
                // Fallback to demo data
                console.log('üîÑ Keine echten Daten gefunden, zeige Demo-Daten...');
                currentReports = getDemoReports();
                filteredReports = [...currentReports];
                await displayReports(currentReports);
                currentStatistics = getDemoStatistics();
                displayStatistics(currentStatistics);
                showMessage('Demo-Modus: Keine echten Daten gefunden. Zeige Beispieldaten.', 'info');
                
            } catch (error) {
                console.error('‚ùå Fehler beim Laden der Spy-Reports:', error);
                currentReports = getDemoReports();
                filteredReports = [...currentReports];
                await displayReports(currentReports);
                currentStatistics = getDemoStatistics();
                displayStatistics(currentStatistics);
                showMessage('Demo-Modus: Fehler beim Laden. Zeige Beispieldaten.', 'info');
            }
        }

        async function loadStatistics() {
            try {
                if (window.SpyDatabaseAPI) {
                    const stats = await window.SpyDatabaseAPI.getStatistics();
                    currentStatistics = stats;
                    displayStatistics(currentStatistics);
                }
            } catch (error) {
                console.error('‚ùå Fehler beim Laden der Statistiken:', error);
            }
        }

        function showMessage(message, type) {
            console.log(`${type.toUpperCase()}: ${message}`);
            
            const statusMessage = document.getElementById('status-message');
            if (statusMessage) {
                statusMessage.textContent = message;
                statusMessage.style.background = type === 'success' ? 'var(--gaming-success)' : 
                                                type === 'error' ? 'var(--danger)' : 
                                                'var(--warning)';
                statusMessage.style.display = 'block';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            }
        }

        // Add event listeners for real-time search
        document.getElementById('playerSearch').addEventListener('input', performSearch);
        document.getElementById('planetSearch').addEventListener('input', performSearch);
        
        // Add Enter key support for spy report input
        document.getElementById('spyReportInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addSpyReport();
            }
        });
    </script>
</body>
</html>