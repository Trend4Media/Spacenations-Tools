name: Advanced Spacenations Deployment

on:
  push:
    branches: [ main ]
    
env:
  SITE_URL: https://${{ github.repository_owner }}.github.io/Spacenations-tools

jobs:
  quality-checks:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: ğŸ” Code Quality Checks
      run: |
        echo "ğŸ” Running quality checks..."
        
        # Check for common issues
        if grep -r "console.log" *.html; then
          echo "âš ï¸ Warning: console.log found in production code"
        fi
        
        # Check for placeholder texts
        if grep -r "PLACEHOLDER\|TODO\|FIXME" *.html; then
          echo "âš ï¸ Warning: Placeholder text found"
        fi
        
        # Check file sizes
        for file in *.html; do
          size=$(stat -f%z "$file" 2>/dev/null || stat -c%s "$file")
          echo "ğŸ“„ $file: ${size} bytes"
          if [ $size -gt 100000 ]; then
            echo "âš ï¸ Warning: $file is quite large (${size} bytes)"
          fi
        done

  deploy:
    needs: quality-checks
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: ğŸš€ Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./
        commit_message: ğŸš€ Deploy ${{ github.sha }}
        
    - name: ğŸŒ Test Deployment
      run: |
        echo "â³ Waiting for deployment..."
        sleep 30
        
        # Test if site is accessible
        if curl -f -s "$SITE_URL" > /dev/null; then
          echo "âœ… Site is live and accessible!"
        else
          echo "âŒ Site might not be accessible yet"
        fi

  notify:
    needs: [quality-checks, deploy]
    runs-on: ubuntu-latest
    if: always()
    steps:
    - name: ğŸ“¢ Deployment Status
      run: |
        if [ "${{ needs.deploy.result }}" == "success" ]; then
          echo "ğŸ‰ Spacenations Tools successfully deployed!"
          echo "ğŸ”— URL: $SITE_URL"
          echo "ğŸ“ Commit: ${{ github.sha }}"
          echo "ğŸ‘¤ Author: ${{ github.actor }}"
        else
          echo "âŒ Deployment failed!"
        fi
