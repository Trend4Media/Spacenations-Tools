<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Nations Kampfbericht Rechner</title>
    <!-- Gemeinsame Theme-Variablen -->
    <link rel="stylesheet" href="css/theme-variables.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Calculator-spezifische Variablen */
        :root {
            --input-bg: rgba(0, 0, 0, 0.8);
            --input-border: rgba(58, 89, 152, 0.5);
            --destroyed-color: #e74c3c;
            --lost-color: #f39c12;
        }
        
        :root.light-mode {
            --input-bg: #f8fafc;
            --input-border: #e2e8f0;
            --destroyed-color: #dc2626;
            --lost-color: #d97706;
        }
        
        
        /* Original Calculator Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--bg-panel);
            border: 2px solid var(--border-primary);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px var(--border-shadow);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .back-button {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(45deg, #3a5998, #4a90e2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-button:hover {
            transform: translateY(-50%) translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
        }
        
        .theme-toggle {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(45deg, #3a5998, #4a90e2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .theme-toggle:hover {
            transform: translateY(-50%) translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
        }
        
        .spacenations {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ff8c42;
            text-shadow: 0 0 10px rgba(255, 140, 66, 0.5);
            letter-spacing: 2px;
            margin: 0;
            line-height: 1;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin: 5px 0 0 0;
            font-weight: normal;
        }
        
        .input-sections {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .input-box {
            background: var(--bg-panel);
            border: 2px solid var(--border-primary);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .input-box.destroyed {
            border-color: var(--destroyed-color);
        }
        
        .input-box.lost {
            border-color: var(--lost-color);
        }
        
        .input-box.smart-parser {
            border-color: #4a90e2;
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.05), rgba(58, 89, 152, 0.05));
        }
        
        .parser-info {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: rgba(74, 144, 226, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(74, 144, 226, 0.2);
            transition: all 0.3s ease;
        }
        
        .info-item:hover {
            background: rgba(74, 144, 226, 0.15);
            transform: translateY(-2px);
        }
        
        .info-icon {
            font-size: 1.2rem;
        }
        
        .info-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .input-box h2 {
            color: #4a90e2;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 0 5px rgba(74, 144, 226, 0.5);
        }
        
        .input-box.destroyed h2 {
            color: var(--destroyed-color);
            text-shadow: 0 0 5px rgba(231, 76, 60, 0.5);
        }
        
        .input-box.lost h2 {
            color: var(--lost-color);
            text-shadow: 0 0 5px rgba(243, 156, 18, 0.5);
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: bold;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            background: var(--input-bg);
            border: 2px solid var(--input-border);
            border-radius: 5px;
            color: var(--text-primary);
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.3);
        }
        
        .button-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        button {
            background: linear-gradient(45deg, #3a5998, #4a90e2);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
        }
        
        .calculate-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }
        
        .clear-btn {
            background: linear-gradient(45deg, #c0392b, #e74c3c);
        }
        
        .results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .result-box {
            background: var(--bg-panel);
            border: 2px solid var(--border-primary);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .result-box h2 {
            color: #4a90e2;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 0 5px rgba(74, 144, 226, 0.5);
        }
        
        .destroyed {
            border-color: var(--destroyed-color);
        }
        
        .destroyed h2 {
            color: var(--destroyed-color);
            text-shadow: 0 0 5px rgba(231, 76, 60, 0.5);
        }
        
        .lost {
            border-color: var(--lost-color);
        }
        
        .lost h2 {
            color: var(--lost-color);
            text-shadow: 0 0 5px rgba(243, 156, 18, 0.5);
        }
        
        .stat-line {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-line:last-child {
            border-bottom: none;
        }
        
        .stat-name {
            color: var(--text-secondary);
        }
        
        .stat-value {
            color: #4a90e2;
            font-weight: bold;
        }
        
        .total-line {
            border-top: 2px solid var(--border-primary);
            margin-top: 10px;
            padding-top: 10px;
            font-weight: bold;
            font-size: 18px;
        }
        
        .total-line .stat-value {
            color: #4a90e2;
            text-shadow: 0 0 5px rgba(74, 144, 226, 0.5);
        }
        
        @media (max-width: 768px) {
            .input-sections,
            .results {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
            
            .button-section {
                flex-direction: column;
                align-items: center;
            }
            
            .spacenations {
                font-size: 2rem;
            }
            
            .back-button,
            .theme-toggle {
                position: static;
                transform: none;
                margin-bottom: 15px;
            }
            
            .back-button:hover,
            .theme-toggle:hover {
                transform: translateY(-2px);
            }
            
            .header {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
        }
    </style>
    <style>
        /* Razer-like design overrides to align with other counters */
        :root {
            --razer-green: #00FF88;
            --razer-green-dark: #00CC6A;
            --razer-green-light: #44FF99;
            --razer-purple: #8B5CF6;
            --razer-black: #0A0A0A;
            --razer-dark: #111111;
            --razer-gray: #1A1A1A;
            --razer-gray-light: #2A2A2A;
            --razer-white: #FFFFFF;
            --razer-silver: #C0C0C0;

            /* Map shared variables to Razer theme */
            --text-primary: var(--razer-white);
            --text-secondary: var(--razer-silver);
            --bg-gradient: linear-gradient(45deg, var(--razer-black) 0%, var(--razer-dark) 100%);
            --bg-panel: var(--razer-dark);
            --border-primary: rgba(0, 255, 136, 0.2);
            --border-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            --card-bg: var(--razer-gray);
            --card-border: rgba(0, 255, 136, 0.2);

            --accent-primary: var(--razer-green);
            --accent-secondary: var(--razer-green-dark);
            --success-color: var(--razer-green);
            --warning-color: #FF9900;
            --error-color: #FF4444;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: var(--razer-black);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 255, 136, 0.05) 0%, transparent 50%),
                linear-gradient(45deg, var(--razer-black) 0%, var(--razer-dark) 100%);
            z-index: -1;
            animation: backgroundPulse 8s ease-in-out infinite;
        }

        @keyframes backgroundPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--bg-panel);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .back-button {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            color: var(--accent-primary);
            border: 2px solid var(--accent-primary);
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Orbitron', monospace;
        }

        .back-button:hover {
            background: var(--accent-primary);
            color: var(--razer-black);
            transform: translateY(-50%) translateY(-2px);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        .spacenations {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--accent-primary);
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
            letter-spacing: 2px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .theme-toggle {
            background: transparent;
            color: var(--accent-primary);
            border: 2px solid var(--accent-primary);
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 700;
        }

        .theme-toggle:hover {
            background: var(--accent-primary);
            color: var(--razer-black);
        }

        .input-box {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 30px;
            transition: all 0.3s ease;
        }

        .input-box:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .input-box.smart-parser {
            border-color: rgba(0, 255, 136, 0.35);
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.05), rgba(0, 0, 0, 0.05));
        }

        .parser-info .info-item {
            background: rgba(0, 255, 136, 0.08);
            border: 1px solid rgba(0, 255, 136, 0.2);
        }

        label {
            color: var(--text-primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        textarea {
            background: var(--razer-gray-light);
            border: 2px solid rgba(0, 255, 136, 0.25);
            border-radius: 8px;
            color: var(--text-primary);
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        textarea:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .button-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .calculate-btn, .clear-btn {
            padding: 16px 32px;
            border: 2px solid var(--accent-primary);
            border-radius: 8px;
            font-family: 'Orbitron', monospace;
            font-weight: 800;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .calculate-btn {
            background: var(--accent-primary);
            color: var(--razer-black);
        }

        .calculate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .calculate-btn:hover::before { left: 100%; }
        .calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 0 30px rgba(0, 255, 136, 0.5); }

        .clear-btn {
            background: transparent;
            color: var(--text-secondary);
            border-color: var(--text-secondary);
        }

        .clear-btn:hover {
            background: var(--error-color);
            color: var(--razer-white);
            border-color: var(--error-color);
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
        }

        .results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .result-box {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 30px;
            transition: all 0.3s ease;
        }

        .result-box:hover {
            border-color: var(--accent-primary);
            transform: translateY(-4px);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .result-box h2 {
            font-family: 'Orbitron', monospace;
            color: var(--accent-primary);
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .destroyed { border-color: var(--error-color); }
        .destroyed h2 { color: var(--error-color); text-shadow: 0 0 10px rgba(255, 68, 68, 0.4); }
        .lost { border-color: var(--warning-color); }
        .lost h2 { color: var(--warning-color); text-shadow: 0 0 10px rgba(255, 153, 0, 0.4); }

        .stat-line { border-bottom: 1px solid rgba(255, 255, 255, 0.08); padding: 12px 0; }
        .stat-name { font-weight: 600; color: var(--text-primary); }
        .stat-value { font-family: 'Orbitron', monospace; font-weight: 800; color: var(--accent-primary); }
        .total-line { border-top: 2px solid var(--card-border); margin-top: 10px; padding-top: 15px; }
        .total-line .stat-value { font-size: 1.3rem; text-shadow: 0 0 10px rgba(0, 255, 136, 0.4); }

        @media (max-width: 768px) {
            .container { padding: 20px; }
            .results { grid-template-columns: 1fr; }
            .button-section { flex-direction: column; align-items: center; }
            .calculate-btn, .clear-btn { width: 100%; max-width: 320px; }
            .back-button, .theme-toggle { position: static; transform: none; margin-bottom: 12px; }
        }
    </style>
    <link rel="stylesheet" href="css/global-footer.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-button">
                <span>←</span>
                <span>Zurück zur Hauptseite</span>
            </a>
            <button class="theme-toggle" id="theme-toggle">
                <span id="theme-icon">🌙</span>
                <span id="theme-text">Light Mode</span>
            </button>
            <h1 class="spacenations">SPACENATIONS</h1>
            <div class="subtitle">Kampfbericht-Rechner</div>
        </div>
        
        <div class="input-sections">
            <div class="input-box smart-parser">
                <h2>🧠 Intelligenter Kampfbericht-Parser</h2>
                <label for="all-reports">Alle Kampfberichte hier einfügen (gemischt möglich):</label>
                <textarea id="all-reports" placeholder="Fügen Sie alle Ihre Kampfberichte hier ein - der Rechner erkennt automatisch:

ZERSTÖRT-Berichte (Ihre Erfolge):
'Die Flotte XYZ zerstörte auf dem Planeten...'

VERLOREN-Berichte (Ihre Verluste):  
'In der Flotte XYZ wurde zerstört auf dem Planeten...'

Einfach alle Berichte gemischt einfügen - der Parser sortiert automatisch!"></textarea>
                
                <div class="parser-info">
                    <div class="info-item">
                        <span class="info-icon">⚔️</span>
                        <span class="info-text">Automatische Erkennung von Zerstört-Berichten</span>
                    </div>
                    <div class="info-item">
                        <span class="info-icon">💀</span>
                        <span class="info-text">Automatische Erkennung von Verloren-Berichten</span>
                    </div>
                    <div class="info-item">
                        <span class="info-icon">📊</span>
                        <span class="info-text">Getrennte Auswertung und Zusammenfassung</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="button-section">
            <button class="calculate-btn" onclick="calculateReports()">📊 Berichte Auswerten</button>
            <button class="clear-btn" onclick="clearAll()">🗑️ Alles Löschen</button>
        </div>
        
        <div class="results">
            <div class="result-box destroyed">
                <h2>⚔️ Zerstört - Summen</h2>
                <div id="destroyed-stats">
                    <div class="stat-line">
                        <span class="stat-name">Stabilität:</span>
                        <span class="stat-value" id="destroyed-stability">0</span>
                    </div>
                    <div class="stat-line">
                        <span class="stat-name">Lagerraum:</span>
                        <span class="stat-value" id="destroyed-storage">0</span>
                    </div>
                    <div class="stat-line">
                        <span class="stat-name">Panzerung:</span>
                        <span class="stat-value" id="destroyed-armor">0</span>
                    </div>
                    <div class="stat-line">
                        <span class="stat-name">Angriffsstärke:</span>
                        <span class="stat-value" id="destroyed-attack">0</span>
                    </div>
                    <div class="stat-line total-line">
                        <span class="stat-name">Anzahl Berichte:</span>
                        <span class="stat-value" id="destroyed-count">0</span>
                    </div>
                </div>
            </div>
            
            <div class="result-box lost">
                <h2>💀 Verloren - Summen</h2>
                <div id="lost-stats">
                    <div class="stat-line">
                        <span class="stat-name">Stabilität:</span>
                        <span class="stat-value" id="lost-stability">0</span>
                    </div>
                    <div class="stat-line">
                        <span class="stat-name">Lagerraum:</span>
                        <span class="stat-value" id="lost-storage">0</span>
                    </div>
                    <div class="stat-line">
                        <span class="stat-name">Panzerung:</span>
                        <span class="stat-value" id="lost-armor">0</span>
                    </div>
                    <div class="stat-line">
                        <span class="stat-name">Angriffsstärke:</span>
                        <span class="stat-value" id="lost-attack">0</span>
                    </div>
                    <div class="stat-line total-line">
                        <span class="stat-name">Anzahl Berichte:</span>
                        <span class="stat-value" id="lost-count">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- JavaScript -->
    <script src="js/firebase-config.js"></script>
    <script src="js/theme-manager.js"></script>

    <script>
        // Intelligente Berechnungslogik für AS-Counter
        function calculateReports() {
            const allReports = document.getElementById('all-reports').value;
            
            if (!allReports.trim()) {
                alert('Bitte fügen Sie mindestens einen Kampfbericht ein.');
                return;
            }
            
            // Berichte intelligent trennen
            const { destroyedReports, lostReports, parseInfo } = intelligentReportParser(allReports);
            
            // Statistiken berechnen
            const destroyedStats = parseReportsData(destroyedReports, 'destroyed');
            const lostStats = parseReportsData(lostReports, 'lost');
            
            // Ergebnisse anzeigen
            updateDestroyedDisplay(destroyedStats);
            updateLostDisplay(lostStats);
            
            // Parse-Info anzeigen
            showParseInfo(parseInfo);
            
            Logger.info('Intelligenter AS-Counter Berechnung durchgeführt', {
                parseInfo: parseInfo,
                destroyed: destroyedStats,
                lost: lostStats
            });
        }
        
        // Intelligenter Parser für gemischte Berichte
        function intelligentReportParser(allReportsText) {
            if (!allReportsText.trim()) {
                return {
                    destroyedReports: [],
                    lostReports: [],
                    parseInfo: {
                        totalReports: 0,
                        destroyedCount: 0,
                        lostCount: 0,
                        unrecognizedCount: 0
                    }
                };
            }
            
            const destroyedReports = [];
            const lostReports = [];
            const unrecognizedReports = [];
            
            // Berichte nach Leerzeilen oder typischen Trennern aufteilen
            const reportBlocks = allReportsText
                .split(/\n\s*\n|\n(?=Die Flotte)|(?=In der Flotte)/)
                .filter(block => block.trim().length > 50); // Nur sinnvolle Blöcke
            
            reportBlocks.forEach((block, index) => {
                const trimmedBlock = block.trim();
                
                // ZERSTÖRT-Muster erkennen
                if (isDestroyedReport(trimmedBlock)) {
                    destroyedReports.push(trimmedBlock);
                }
                // VERLOREN-Muster erkennen
                else if (isLostReport(trimmedBlock)) {
                    lostReports.push(trimmedBlock);
                }
                // Unerkannt
                else if (trimmedBlock.length > 20) {
                    unrecognizedReports.push(trimmedBlock);
                }
            });
            
            const parseInfo = {
                totalReports: reportBlocks.length,
                destroyedCount: destroyedReports.length,
                lostCount: lostReports.length,
                unrecognizedCount: unrecognizedReports.length,
                unrecognizedReports: unrecognizedReports
            };
            
            return {
                destroyedReports,
                lostReports,
                parseInfo
            };
        }
        
        // Erkennt "Zerstört"-Berichte (Ihre Erfolge)
        function isDestroyedReport(reportText) {
            const destroyedPatterns = [
                /Die Flotte.*?zerstörte auf dem Planeten/i,
                /zerstörte.*?auf dem Planeten.*?in einer.*?Flotte/i,
                /Die Flotte wurde zerstört\./i  // Am Ende des Berichts
            ];
            
            return destroyedPatterns.some(pattern => pattern.test(reportText));
        }
        
        // Erkennt "Verloren"-Berichte (Ihre Verluste)
        function isLostReport(reportText) {
            const lostPatterns = [
                /In der Flotte.*?wurde zerstört auf dem Planeten/i,
                /wurde zerstört auf dem Planeten/i,
                /Schiffstyp.*?Anzahl/i  // Typisch für Verlust-Berichte
            ];
            
            return lostPatterns.some(pattern => pattern.test(reportText));
        }
        
        // Parse-Info für Benutzer anzeigen
        function showParseInfo(parseInfo) {
            const message = `
🧠 Intelligente Analyse abgeschlossen:

📊 Berichte analysiert: ${parseInfo.totalReports}
⚔️ Zerstört-Berichte: ${parseInfo.destroyedCount}
💀 Verloren-Berichte: ${parseInfo.lostCount}
❓ Unerkannt: ${parseInfo.unrecognizedCount}

${parseInfo.unrecognizedCount > 0 ? 
  '⚠️ Hinweis: Einige Berichte wurden nicht erkannt. Prüfen Sie das Format.' : 
  '✅ Alle Berichte erfolgreich kategorisiert!'}
            `;
            
            console.log(message);
            
            // Optional: Kurze Benachrichtigung
            if (parseInfo.unrecognizedCount > 0) {
                setTimeout(() => {
                    alert(`Parser-Info: ${parseInfo.destroyedCount} Zerstört, ${parseInfo.lostCount} Verloren, ${parseInfo.unrecognizedCount} unerkannt.`);
                }, 500);
            }
        }
        
        function parseReportsData(reportsArray, type) {
            if (!reportsArray || reportsArray.length === 0) {
                return {
                    stability: 0,
                    storage: 0,
                    armor: 0,
                    attack: 0,
                    count: 0
                };
            }
            
            // Array zu Text für bestehende Parsing-Logik
            const reportsText = reportsArray.join('\n\n');
            
            const stats = {
                stability: 0,
                storage: 0,
                armor: 0,
                attack: 0,
                count: 0
            };
            
            // Berichte nach "Die Flotte" aufteilen
            const reports = reportsText.split(/Die Flotte.*?zerstörte/g).filter(report => report.trim());
            stats.count = reports.length;
            
            // Regex-Patterns für die verschiedenen Werte
            const patterns = {
                stability: /(\d+(?:\.\d+)?)\s*Stabilität/gi,
                storage: /(\d+(?:\.\d+)?)\s*Lagerraum/gi,
                armor: /(\d+(?:\.\d+)?)\s*Panzerung/gi,
                attack: /(\d+(?:\.\d+)?)\s*Angriffsstärke/gi
            };
            
            // Jeden Bericht durchgehen
            reports.forEach(report => {
                Object.entries(patterns).forEach(([key, pattern]) => {
                    const matches = report.matchAll(pattern);
                    for (const match of matches) {
                        const value = parseFloat(match[1].replace(/\./g, '')) || 0;
                        stats[key] += value;
                    }
                });
            });
            
            // Auch den gesamten Text durchsuchen (für Fälle wo Split nicht perfekt funktioniert)
            Object.entries(patterns).forEach(([key, pattern]) => {
                const matches = reportsText.matchAll(pattern);
                let totalFromText = 0;
                for (const match of matches) {
                    const value = parseFloat(match[1].replace(/\./g, '')) || 0;
                    totalFromText += value;
                }
                // Nehme den höheren Wert (aus Reports oder aus Gesamttext)
                if (totalFromText > stats[key]) {
                    stats[key] = totalFromText;
                    // Berichte-Anzahl korrigieren
                    if (key === 'stability') {
                        stats.count = (reportsText.match(/(\d+(?:\.\d+)?)\s*Stabilität/gi) || []).length;
                    }
                }
            });
            
            return stats;
        }
        
        function updateDestroyedDisplay(stats) {
            document.getElementById('destroyed-stability').textContent = formatNumber(stats.stability);
            document.getElementById('destroyed-storage').textContent = formatNumber(stats.storage);
            document.getElementById('destroyed-armor').textContent = formatNumber(stats.armor);
            document.getElementById('destroyed-attack').textContent = formatNumber(stats.attack);
            document.getElementById('destroyed-count').textContent = stats.count;
        }
        
        function updateLostDisplay(stats) {
            document.getElementById('lost-stability').textContent = formatNumber(stats.stability);
            document.getElementById('lost-storage').textContent = formatNumber(stats.storage);
            document.getElementById('lost-armor').textContent = formatNumber(stats.armor);
            document.getElementById('lost-attack').textContent = formatNumber(stats.attack);
            document.getElementById('lost-count').textContent = stats.count;
        }
        
        function formatNumber(num) {
            // Vollständige Zahlen ohne Rundung anzeigen
            return num.toLocaleString('de-DE');
        }
        
        function clearAll() {
            // Textarea leeren
            document.getElementById('all-reports').value = '';
            
            // Ergebnisse zurücksetzen
            const emptyStats = { stability: 0, storage: 0, armor: 0, attack: 0, count: 0 };
            
            updateDestroyedDisplay(emptyStats);
            updateLostDisplay(emptyStats);
            
            console.log('🧠 Intelligenter AS-Counter zurückgesetzt');
            Logger.info('Intelligenter AS-Counter zurückgesetzt');
        }
        
        
        // Test mit Ihren gemischten Beispiel-Berichten
        function testWithExampleReports() {
            const mixedExampleReports = `Die Flotte a-s 5k zerstörte auf dem Planeten Proxima 6-44 (555:291:3) in einer Flotte des Spielers (übergeben von ) :
128 Stabilität
327 Lagerraum
0 Panzerung
0 Angriffsstärke
Die Flotte wurde zerstört.

Am Kampf beteiligt waren:
Eine Flotte des Spielers Dichter als Goethe (übergeben von SirDaiking )

In der Flotte a-s 5k wurde zerstört auf dem Planeten 555:817:2
257 Stabilität
327 Lagerraum
8 Panzerung
72 Angriffsstärke

Schiffstyp	Anzahl
MicroMachine	1

Am Kampf beteiligt waren:
1 getarnte Flotte(n)

Die Flotte ***_ST:3.0K_AS:864_PZ:96 zerstörte auf dem Planeten Proxima 3-6 (555:626:9) in einer Flotte des Spielers :
2.265 Stabilität
3.845 Lagerraum
95 Panzerung
1.120 Angriffsstärke
Die Flotte wurde zerstört.`;
            
            document.getElementById('all-reports').value = mixedExampleReports;
            calculateReports();
            
            console.log('🧠 Test mit gemischten Beispiel-Berichten durchgeführt');
            console.log('Erwartete Ergebnisse:');
            console.log('ZERSTÖRT: 2393 Stabilität, 4172 Lagerraum, 95 Panzerung, 1120 AS (2 Berichte)');
            console.log('VERLOREN: 257 Stabilität, 327 Lagerraum, 8 Panzerung, 72 AS (1 Bericht)');
        }
        
        // Test-Funktion global verfügbar machen
        window.testASCounter = testWithExampleReports;
    </script>
    <!-- Auto-Loading Scripts - Immer als LETZTES vor </body> -->
<script>
    /**
     * UNIVERSELLER Auto-Loader für alle Spacenations-Tools
     * Lädt automatisch alle benötigten Skripte auf jeder Seite
     */
    
    // 1. CSS für Global Footer sicherstellen
    function ensureGlobalFooterCSS() {
        const cssId = 'global-footer-css';
        if (!document.getElementById(cssId)) {
            const link = document.createElement('link');
            link.id = cssId;
            link.rel = 'stylesheet';
            link.href = 'css/global-footer.css';
            link.onerror = () => {
                console.warn('⚠️ css/global-footer.css nicht gefunden');
            };
            document.head.appendChild(link);
        }
    }
    
    // 2. Auto-Loader für JavaScript-Module
    function loadAutoScript(src, callback) {
        const script = document.createElement('script');
        script.src = src;
        script.async = true;
        script.onload = () => {
            console.log('✅ Auto-geladen:', src);
            if (callback) callback();
        };
        script.onerror = () => {
            console.warn('⚠️ Auto-Load fehlgeschlagen:', src);
            if (callback) callback();
        };
        document.head.appendChild(script);
    }
    
    // 3. Initiale Auto-Loads
    function initAutoLoads() {
        // CSS sicherstellen
        ensureGlobalFooterCSS();
        
        // Universelle Scripts in der richtigen Reihenfolge laden
        const autoScripts = [
            'js/theme-manager.js',
            'js/global-footer-loader.js'  // Ihr reparierter Footer-Loader
        ];
        
        let loadIndex = 0;
        
        function loadNext() {
            if (loadIndex < autoScripts.length) {
                loadAutoScript(autoScripts[loadIndex], () => {
                    loadIndex++;
                    setTimeout(loadNext, 100); // Kleine Verzögerung zwischen Loads
                });
            } else {
                // Alle Scripts geladen
                console.log('🚀 Alle Auto-Scripts geladen');
                initializeAutoFeatures();
            }
        }
        
        loadNext();
    }
    
    // 4. Auto-Features nach dem Laden initialisieren
    function initializeAutoFeatures() {
        // Theme-System aktivieren
        setTimeout(() => {
            if (window.ThemeAPI) {
                // Theme-Toggle-Buttons automatisch konfigurieren
                const themeButtons = document.querySelectorAll('.theme-toggle, #theme-toggle');
                themeButtons.forEach(btn => {
                    if (!btn.dataset.autoConfigured) {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            window.ThemeAPI.toggle();
                        });
                        btn.dataset.autoConfigured = 'true';
                    }
                });
            }
        }, 500);
        
        // Footer-Status prüfen
        setTimeout(() => {
            if (window.AutoFooterAPI) {
                console.log('✅ Auto-Footer bereit');
            } else {
                console.warn('⚠️ Auto-Footer nicht verfügbar');
            }
        }, 1000);
    }
    
    // 5. Firebase Auto-Load für Dashboard-Seiten
    function loadFirebaseIfNeeded() {
        const isDashboardPage = window.location.pathname.includes('dashboard') || 
                               window.location.pathname.includes('register') ||
                               document.querySelector('[id*="dashboard"]') ||
                               document.querySelector('[class*="dashboard"]');
        
        if (isDashboardPage) {
            console.log('📊 Dashboard-Seite erkannt - Firebase wird geladen');
            
            // Firebase SDK laden
            if (!window.firebase) {
                const firebaseScripts = [
                    'https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js',
                    'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js',
                    'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js'
                ];
                
                let fbIndex = 0;
                function loadNextFirebase() {
                    if (fbIndex < firebaseScripts.length) {
                        loadAutoScript(firebaseScripts[fbIndex], () => {
                            fbIndex++;
                            loadNextFirebase();
                        });
                    } else {
                        // Firebase geladen, jetzt Config laden
                        setTimeout(() => {
                            loadAutoScript('js/firebase-config.js', () => {
                                loadAutoScript('js/auth-manager.js', () => {
                                    loadAutoScript('js/firebase-sync.js');
                                });
                            });
                        }, 500);
                    }
                }
                loadNextFirebase();
            }
        }
    }
    
    // 6. SOFORTIGER Start des Auto-Loaders
    function startAutoLoader() {
        console.log('🤖 Auto-Loader gestartet für:', window.location.pathname);
        
        // CSS und grundlegende Scripts
        initAutoLoads();
        
        // Firebase für Dashboard-Seiten
        loadFirebaseIfNeeded();
        
        // Page-spezifische Auto-Loads
        setTimeout(() => {
            const pageName = window.location.pathname.split('/').pop().split('.')[0] || 'index';
            
            // Calculator-spezifische Scripts
            if (pageName.includes('calculator')) {
                loadAutoScript('js/calculator-data.js');
            }
            
            // Raid-Counter-spezifische Scripts  
            if (pageName.includes('raid')) {
                loadAutoScript('js/raid-data-manager.js');
            }
            
        }, 1500);
    }
    
    // 7. Auto-Loader starten (mehrere Einstiegspunkte)
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', startAutoLoader);
    } else {
        startAutoLoader();
    }
    
    // Backup für sehr späte Initialisierung
    setTimeout(startAutoLoader, 2000);
    
    console.log('🔄 Auto-Include Script geladen - Footer wird automatisch auf JEDER Seite angezeigt!');
</script>

<!-- Ende Auto-Include Script -->
</body>
</html>
