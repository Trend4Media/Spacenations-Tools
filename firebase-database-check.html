<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Datenbank-Check - Spacenations Tools</title>
    <style>
        :root {
            --primary: #00FF88;
            --bg-dark: #0A0A0A;
            --bg-card: #111111;
            --border: rgba(0, 255, 136, 0.2);
            --text-primary: #FFFFFF;
            --text-secondary: #C0C0C0;
            --error: #FF4444;
            --success: #00FF88;
            --warning: #FFA500;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .title {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 16px;
        }
        
        .section {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0;
        }
        
        .section h3 {
            color: var(--primary);
            margin-bottom: 16px;
            font-size: 20px;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: var(--primary);
            color: var(--bg-dark);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 8px 8px 8px 0;
            text-decoration: none;
        }
        
        .btn:hover {
            background: #00CC6A;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 16px;
            padding: 16px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }
        
        .result.success {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: var(--success);
        }
        
        .result.error {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
            color: var(--error);
        }
        
        .result.warning {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            color: var(--warning);
        }
        
        .result.info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3b82f6;
        }
        
        .config-display {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
        
        .highlight {
            color: var(--primary);
            font-weight: bold;
        }
        
        .warning-box {
            background: rgba(255, 165, 0, 0.1);
            border: 2px solid var(--warning);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .warning-box h4 {
            color: var(--warning);
            margin-bottom: 12px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üîç Firebase Datenbank-Check</h1>
            <p class="subtitle">√úberpr√ºft die Firebase-Konfiguration und Datenbankverbindung</p>
        </div>
        
        <div class="warning-box">
            <h4>‚ö†Ô∏è Wichtiger Hinweis</h4>
            <p>Sie haben erw√§hnt, dass das System m√∂glicherweise nicht mehr auf die richtige Datenbank zugreift. 
            Dieses Tool √ºberpr√ºft die aktuelle Firebase-Konfiguration und vergleicht sie mit der erwarteten Datenbank.</p>
            <p><strong>Erwartete Firebase Console URL:</strong> 
            <a href="https://console.firebase.google.com/u/0/project/spacenations-tools/firestore/databases/-default-/data" 
               target="_blank" style="color: var(--primary);">
               https://console.firebase.google.com/u/0/project/spacenations-tools/firestore/databases/-default-/data
            </a></p>
        </div>
        
        <div class="grid">
            <div class="section">
                <h3>üîß Firebase Konfiguration</h3>
                <p>√úberpr√ºft die aktuelle Firebase-Konfiguration und Projekt-ID</p>
                <button class="btn" onclick="checkFirebaseConfig()">Konfiguration pr√ºfen</button>
                <div id="config-result" class="result"></div>
            </div>
            
            <div class="section">
                <h3>üîó Datenbankverbindung</h3>
                <p>Testet die Verbindung zur Firestore-Datenbank</p>
                <button class="btn" onclick="testDatabaseConnection()">Verbindung testen</button>
                <div id="connection-result" class="result"></div>
            </div>
        </div>
        
        <div class="section">
            <h3>üìä Datenbank-Inhalte pr√ºfen</h3>
            <p>√úberpr√ºft, ob die erwarteten Collections und Daten vorhanden sind</p>
            <button class="btn" onclick="checkDatabaseContents()">Inhalte pr√ºfen</button>
            <button class="btn" onclick="checkUserActivities()">userActivities Collection</button>
            <button class="btn" onclick="checkUsers()">users Collection</button>
            <div id="contents-result" class="result"></div>
        </div>
        
        <div class="section">
            <h3>üîç Projekt-ID Verifikation</h3>
            <p>Vergleicht die aktuelle Projekt-ID mit der erwarteten</p>
            <button class="btn" onclick="verifyProjectId()">Projekt-ID pr√ºfen</button>
            <div id="project-result" class="result"></div>
        </div>
        
        <div class="section">
            <h3>üõ†Ô∏è Konfiguration reparieren</h3>
            <p>Tools zur Reparatur der Firebase-Konfiguration</p>
            <button class="btn" onclick="showConfigFix()">Reparatur-Anleitung</button>
            <button class="btn" onclick="testAlternativeConfig()">Alternative Config testen</button>
            <div id="fix-result" class="result"></div>
        </div>
        
        <div id="overall-status" class="section" style="display: none;">
            <h3>üìã Gesamtstatus</h3>
            <div id="status-content"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- App Scripts -->
    <script src="js/firebase-config.js"></script>
    
    <script>
        const EXPECTED_PROJECT_ID = 'spacenations-tools';
        const EXPECTED_AUTH_DOMAIN = 'spacenations-tools.firebaseapp.com';
        
        // Utility functions
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = message;
            element.style.display = 'block';
        }
        
        function showResultHTML(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.innerHTML = message;
            element.style.display = 'block';
        }
        
        async function waitForFirebase() {
            if (!window.FirebaseConfig) {
                await new Promise(resolve => {
                    const checkFirebase = setInterval(() => {
                        if (window.FirebaseConfig) {
                            clearInterval(checkFirebase);
                            resolve();
                        }
                    }, 100);
                });
            }
            
            try {
                await window.FirebaseConfig.waitForReady();
            } catch (error) {
                console.warn('Firebase wait failed, continuing anyway:', error);
            }
        }
        
        // Check Firebase configuration
        async function checkFirebaseConfig() {
            try {
                showResult('config-result', 'üîÑ √úberpr√ºfe Firebase-Konfiguration...', 'info');
                
                await waitForFirebase();
                
                let result = 'üîß Firebase-Konfiguration:\n\n';
                
                // Check if Firebase is available
                if (typeof firebase === 'undefined') {
                    result += '‚ùå Firebase SDK nicht geladen\n';
                    showResult('config-result', result, 'error');
                    return;
                }
                
                // Get current Firebase app config
                const app = firebase.app();
                const config = app.options;
                
                result += `üìã Aktuelle Konfiguration:\n`;
                result += `‚Ä¢ Projekt-ID: ${config.projectId || 'NICHT GESETZT'}\n`;
                result += `‚Ä¢ Auth Domain: ${config.authDomain || 'NICHT GESETZT'}\n`;
                result += `‚Ä¢ API Key: ${config.apiKey ? config.apiKey.substring(0, 20) + '...' : 'NICHT GESETZT'}\n`;
                result += `‚Ä¢ Storage Bucket: ${config.storageBucket || 'NICHT GESETZT'}\n`;
                result += `‚Ä¢ App ID: ${config.appId || 'NICHT GESETZT'}\n\n`;
                
                // Verify against expected values
                result += `üîç Verifikation:\n`;
                result += `‚Ä¢ Projekt-ID korrekt: ${config.projectId === EXPECTED_PROJECT_ID ? '‚úÖ' : '‚ùå'}\n`;
                result += `‚Ä¢ Auth Domain korrekt: ${config.authDomain === EXPECTED_AUTH_DOMAIN ? '‚úÖ' : '‚ùå'}\n`;
                result += `‚Ä¢ API Key vorhanden: ${config.apiKey ? '‚úÖ' : '‚ùå'}\n\n`;
                
                // Check FirebaseConfig wrapper
                result += `üîß FirebaseConfig Status:\n`;
                result += `‚Ä¢ FirebaseConfig verf√ºgbar: ${window.FirebaseConfig ? '‚úÖ' : '‚ùå'}\n`;
                result += `‚Ä¢ Initialisiert: ${window.FirebaseConfig?.isReady() ? '‚úÖ' : '‚ùå'}\n`;
                result += `‚Ä¢ Offline Modus: ${window.FirebaseConfig?.isOffline() ? '‚ùå Ja' : '‚úÖ Nein'}\n`;
                
                const isConfigCorrect = config.projectId === EXPECTED_PROJECT_ID && 
                                      config.authDomain === EXPECTED_AUTH_DOMAIN && 
                                      config.apiKey;
                
                showResult('config-result', result, isConfigCorrect ? 'success' : 'warning');
                
            } catch (error) {
                console.error('Config check failed:', error);
                showResult('config-result', `‚ùå Konfigurationspr√ºfung fehlgeschlagen:\n${error.message}`, 'error');
            }
        }
        
        // Test database connection
        async function testDatabaseConnection() {
            try {
                showResult('connection-result', 'üîÑ Teste Datenbankverbindung...', 'info');
                
                await waitForFirebase();
                
                const db = window.FirebaseConfig?.getDB();
                if (!db) {
                    showResult('connection-result', '‚ùå Firestore-Datenbank nicht verf√ºgbar', 'error');
                    return;
                }
                
                let result = 'üîó Datenbankverbindung:\n\n';
                
                // Test basic connection
                try {
                    const testDoc = await db.collection('_test').doc('connection-test').get();
                    result += '‚úÖ Grundverbindung zur Datenbank funktioniert\n';
                } catch (dbError) {
                    result += `‚ö†Ô∏è Datenbankverbindung: ${dbError.message}\n`;
                }
                
                // Test app configuration
                const app = db.app;
                result += `üìã Verbundene App:\n`;
                result += `‚Ä¢ App Name: ${app.name}\n`;
                result += `‚Ä¢ Projekt-ID: ${app.options.projectId}\n`;
                result += `‚Ä¢ Auth Domain: ${app.options.authDomain}\n\n`;
                
                // Test permissions
                try {
                    const collections = ['users', 'userActivities', 'alliances'];
                    result += 'üîí Berechtigungstest:\n';
                    
                    for (const collection of collections) {
                        try {
                            const query = await db.collection(collection).limit(1).get();
                            result += `‚Ä¢ ${collection}: ‚úÖ Leseberechtigung OK\n`;
                        } catch (permError) {
                            result += `‚Ä¢ ${collection}: ‚ùå ${permError.message}\n`;
                        }
                    }
                } catch (error) {
                    result += `‚ö†Ô∏è Berechtigungstest fehlgeschlagen: ${error.message}\n`;
                }
                
                showResult('connection-result', result, 'success');
                
            } catch (error) {
                console.error('Connection test failed:', error);
                showResult('connection-result', `‚ùå Verbindungstest fehlgeschlagen:\n${error.message}`, 'error');
            }
        }
        
        // Check database contents
        async function checkDatabaseContents() {
            try {
                showResult('contents-result', 'üîÑ √úberpr√ºfe Datenbank-Inhalte...', 'info');
                
                await waitForFirebase();
                
                const db = window.FirebaseConfig?.getDB();
                if (!db) {
                    showResult('contents-result', '‚ùå Firestore-Datenbank nicht verf√ºgbar', 'error');
                    return;
                }
                
                let result = 'üìä Datenbank-Inhalte:\n\n';
                
                // Check main collections
                const collections = ['users', 'userActivities', 'alliances', 'userStats'];
                
                for (const collectionName of collections) {
                    try {
                        const snapshot = await db.collection(collectionName).limit(5).get();
                        result += `üìÅ ${collectionName}:\n`;
                        result += `  ‚Ä¢ Dokumente gefunden: ${snapshot.size}\n`;
                        
                        if (snapshot.size > 0) {
                            result += `  ‚Ä¢ Beispiel-Dokumente:\n`;
                            snapshot.forEach((doc, index) => {
                                if (index < 3) {
                                    const data = doc.data();
                                    result += `    - ${doc.id}: ${JSON.stringify(Object.keys(data)).substring(0, 50)}...\n`;
                                }
                            });
                        }
                        result += '\n';
                        
                    } catch (error) {
                        result += `üìÅ ${collectionName}: ‚ùå ${error.message}\n\n`;
                    }
                }
                
                showResult('contents-result', result, 'info');
                
            } catch (error) {
                console.error('Contents check failed:', error);
                showResult('contents-result', `‚ùå Inhalts-√úberpr√ºfung fehlgeschlagen:\n${error.message}`, 'error');
            }
        }
        
        // Check userActivities specifically
        async function checkUserActivities() {
            try {
                showResult('contents-result', 'üîÑ √úberpr√ºfe userActivities Collection...', 'info');
                
                await waitForFirebase();
                
                const db = window.FirebaseConfig?.getDB();
                if (!db) {
                    showResult('contents-result', '‚ùå Firestore-Datenbank nicht verf√ºgbar', 'error');
                    return;
                }
                
                let result = 'üìã userActivities Collection:\n\n';
                
                try {
                    const snapshot = await db.collection('userActivities')
                        .orderBy('timestamp', 'desc')
                        .limit(10)
                        .get();
                    
                    result += `üìä Statistiken:\n`;
                    result += `‚Ä¢ Gesamte Dokumente: ${snapshot.size}\n`;
                    result += `‚Ä¢ Abfrage erfolgreich: ‚úÖ\n\n`;
                    
                    if (snapshot.size > 0) {
                        result += `üîç Letzte Aktivit√§ten:\n`;
                        snapshot.forEach((doc, index) => {
                            const data = doc.data();
                            const timestamp = data.timestamp?.toDate?.() || new Date(data.timestamp);
                            result += `${index + 1}. ${data.icon || 'üìù'} ${data.text || 'Keine Beschreibung'}\n`;
                            result += `   User: ${data.userId || 'Unbekannt'}\n`;
                            result += `   Zeit: ${timestamp.toLocaleString('de-DE')}\n\n`;
                        });
                    } else {
                        result += '‚ö†Ô∏è Keine userActivities gefunden\n';
                        result += 'Das k√∂nnte bedeuten:\n';
                        result += '‚Ä¢ Die Collection ist leer\n';
                        result += '‚Ä¢ Berechtigungsprobleme\n';
                        result += '‚Ä¢ Falsche Datenbank\n';
                    }
                    
                } catch (error) {
                    result += `‚ùå Fehler beim Abrufen der userActivities:\n`;
                    result += `${error.message}\n\n`;
                    
                    if (error.code === 'permission-denied') {
                        result += 'üîí Berechtigungsproblem erkannt!\n';
                        result += 'M√∂gliche Ursachen:\n';
                        result += '‚Ä¢ Firestore-Sicherheitsregeln zu restriktiv\n';
                        result += '‚Ä¢ Falsche Authentifizierung\n';
                        result += '‚Ä¢ Falsche Datenbank\n';
                    }
                }
                
                showResult('contents-result', result, 'info');
                
            } catch (error) {
                console.error('UserActivities check failed:', error);
                showResult('contents-result', `‚ùå userActivities-√úberpr√ºfung fehlgeschlagen:\n${error.message}`, 'error');
            }
        }
        
        // Check users collection
        async function checkUsers() {
            try {
                showResult('contents-result', 'üîÑ √úberpr√ºfe users Collection...', 'info');
                
                await waitForFirebase();
                
                const db = window.FirebaseConfig?.getDB();
                if (!db) {
                    showResult('contents-result', '‚ùå Firestore-Datenbank nicht verf√ºgbar', 'error');
                    return;
                }
                
                let result = 'üë• users Collection:\n\n';
                
                try {
                    const snapshot = await db.collection('users').limit(10).get();
                    
                    result += `üìä Statistiken:\n`;
                    result += `‚Ä¢ Gefundene Benutzer: ${snapshot.size}\n`;
                    result += `‚Ä¢ Abfrage erfolgreich: ‚úÖ\n\n`;
                    
                    if (snapshot.size > 0) {
                        result += `üë§ Benutzer-√úbersicht:\n`;
                        snapshot.forEach((doc, index) => {
                            const data = doc.data();
                            result += `${index + 1}. ${data.username || data.email || doc.id}\n`;
                            result += `   E-Mail: ${data.email || 'Nicht gesetzt'}\n`;
                            result += `   Rolle: ${data.systemRole || data.role || 'user'}\n`;
                            result += `   Super-Admin: ${data.isSuperAdmin ? '‚úÖ' : '‚ùå'}\n`;
                            result += `   Aktiv: ${data.isActive !== false ? '‚úÖ' : '‚ùå'}\n\n`;
                        });
                        
                        // Check for the specific user
                        const userQuery = await db.collection('users')
                            .where('email', '==', 't.o@trend4media.de')
                            .get();
                        
                        result += `üîç Spezifische Benutzer-Suche:\n`;
                        result += `‚Ä¢ t.o@trend4media.de: ${userQuery.empty ? '‚ùå Nicht gefunden' : '‚úÖ Gefunden'}\n`;
                        
                        if (!userQuery.empty) {
                            const userData = userQuery.docs[0].data();
                            result += `  - Username: ${userData.username}\n`;
                            result += `  - Super-Admin: ${userData.isSuperAdmin ? '‚úÖ' : '‚ùå'}\n`;
                            result += `  - Rolle: ${userData.systemRole || userData.role}\n`;
                        }
                        
                    } else {
                        result += '‚ö†Ô∏è Keine Benutzer gefunden\n';
                        result += 'Das ist ungew√∂hnlich und k√∂nnte bedeuten:\n';
                        result += '‚Ä¢ Falsche Datenbank\n';
                        result += '‚Ä¢ Berechtigungsprobleme\n';
                        result += '‚Ä¢ Datenbank wurde geleert\n';
                    }
                    
                } catch (error) {
                    result += `‚ùå Fehler beim Abrufen der Benutzer:\n`;
                    result += `${error.message}\n`;
                }
                
                showResult('contents-result', result, 'info');
                
            } catch (error) {
                console.error('Users check failed:', error);
                showResult('contents-result', `‚ùå Benutzer-√úberpr√ºfung fehlgeschlagen:\n${error.message}`, 'error');
            }
        }
        
        // Verify project ID
        async function verifyProjectId() {
            try {
                showResult('project-result', 'üîÑ Verifiziere Projekt-ID...', 'info');
                
                await waitForFirebase();
                
                let result = 'üîç Projekt-ID Verifikation:\n\n';
                
                // Get current project ID
                const app = firebase.app();
                const currentProjectId = app.options.projectId;
                
                result += `üìã Aktuelle Konfiguration:\n`;
                result += `‚Ä¢ Projekt-ID: ${currentProjectId}\n`;
                result += `‚Ä¢ Erwartet: ${EXPECTED_PROJECT_ID}\n`;
                result += `‚Ä¢ √úbereinstimmung: ${currentProjectId === EXPECTED_PROJECT_ID ? '‚úÖ' : '‚ùå'}\n\n`;
                
                // Check console URL
                const consoleUrl = `https://console.firebase.google.com/u/0/project/${currentProjectId}/firestore/databases/-default-/data`;
                result += `üåê Firebase Console URLs:\n`;
                result += `‚Ä¢ Aktuelle DB: ${consoleUrl}\n`;
                result += `‚Ä¢ Erwartete DB: https://console.firebase.google.com/u/0/project/${EXPECTED_PROJECT_ID}/firestore/databases/-default-/data\n\n`;
                
                if (currentProjectId !== EXPECTED_PROJECT_ID) {
                    result += `‚ö†Ô∏è PROBLEM ERKANNT!\n`;
                    result += `Das System verwendet eine andere Projekt-ID als erwartet.\n`;
                    result += `Dies erkl√§rt, warum Sie auf die falsche Datenbank zugreifen.\n\n`;
                    result += `üõ†Ô∏è L√∂sungsvorschl√§ge:\n`;
                    result += `1. √úberpr√ºfen Sie die Firebase-Konfiguration\n`;
                    result += `2. Stellen Sie sicher, dass die richtige Projekt-ID verwendet wird\n`;
                    result += `3. √úberpr√ºfen Sie die API-Konfiguration\n`;
                }
                
                const type = currentProjectId === EXPECTED_PROJECT_ID ? 'success' : 'warning';
                showResult('project-result', result, type);
                
            } catch (error) {
                console.error('Project verification failed:', error);
                showResult('project-result', `‚ùå Projekt-Verifikation fehlgeschlagen:\n${error.message}`, 'error');
            }
        }
        
        // Show configuration fix
        async function showConfigFix() {
            const result = `üõ†Ô∏è Firebase-Konfiguration reparieren:

üìã Schritt 1: Aktuelle Konfiguration √ºberpr√ºfen
‚Ä¢ √ñffnen Sie die Browser-Entwicklertools (F12)
‚Ä¢ Gehen Sie zur Console
‚Ä¢ F√ºhren Sie aus: console.log(firebase.app().options)

üìã Schritt 2: Korrekte Konfiguration sicherstellen
‚Ä¢ Projekt-ID sollte sein: ${EXPECTED_PROJECT_ID}
‚Ä¢ Auth Domain sollte sein: ${EXPECTED_AUTH_DOMAIN}

üìã Schritt 3: Konfigurationsdateien pr√ºfen
‚Ä¢ firebase-config.json
‚Ä¢ js/firebase-config.js
‚Ä¢ Alle HTML-Dateien mit Firebase-Konfiguration

üìã Schritt 4: API-Endpunkt pr√ºfen
‚Ä¢ /api/firebase-config sollte die korrekte Konfiguration zur√ºckgeben
‚Ä¢ Fallback-Konfiguration in firebase-config.js √ºberpr√ºfen

üìã Schritt 5: Cache leeren
‚Ä¢ Browser-Cache leeren
‚Ä¢ Service Worker deaktivieren (falls vorhanden)
‚Ä¢ Hard Refresh (Ctrl+Shift+R)

üîó N√ºtzliche Links:
‚Ä¢ Firebase Console: https://console.firebase.google.com/
‚Ä¢ Projekt-Einstellungen: https://console.firebase.google.com/project/${EXPECTED_PROJECT_ID}/settings/general
‚Ä¢ Firestore-Datenbank: https://console.firebase.google.com/project/${EXPECTED_PROJECT_ID}/firestore`;

            showResult('fix-result', result, 'info');
        }
        
        // Test alternative configuration
        async function testAlternativeConfig() {
            try {
                showResult('fix-result', 'üîÑ Teste alternative Konfiguration...', 'info');
                
                // Try to load configuration from API
                let result = 'üß™ Alternative Konfigurations-Test:\n\n';
                
                try {
                    const response = await fetch('/api/firebase-config');
                    if (response.ok) {
                        const apiConfig = await response.json();
                        result += '‚úÖ API-Konfiguration verf√ºgbar:\n';
                        result += `‚Ä¢ Projekt-ID: ${apiConfig.projectId}\n`;
                        result += `‚Ä¢ Auth Domain: ${apiConfig.authDomain}\n`;
                        result += `‚Ä¢ √úbereinstimmung: ${apiConfig.projectId === EXPECTED_PROJECT_ID ? '‚úÖ' : '‚ùå'}\n\n`;
                    } else {
                        result += '‚ùå API-Konfiguration nicht verf√ºgbar\n\n';
                    }
                } catch (apiError) {
                    result += `‚ö†Ô∏è API-Fehler: ${apiError.message}\n\n`;
                }
                
                // Check local configuration files
                try {
                    const localResponse = await fetch('/firebase-config.json');
                    if (localResponse.ok) {
                        const localConfig = await localResponse.json();
                        result += 'üìÅ Lokale Konfigurationsdatei:\n';
                        result += `‚Ä¢ Projekt-ID: ${localConfig.projectId}\n`;
                        result += `‚Ä¢ Auth Domain: ${localConfig.authDomain}\n`;
                        result += `‚Ä¢ √úbereinstimmung: ${localConfig.projectId === EXPECTED_PROJECT_ID ? '‚úÖ' : '‚ùå'}\n\n`;
                    } else {
                        result += '‚ùå Lokale Konfigurationsdatei nicht gefunden\n\n';
                    }
                } catch (localError) {
                    result += `‚ö†Ô∏è Lokale Datei-Fehler: ${localError.message}\n\n`;
                }
                
                result += 'üí° Empfehlung:\n';
                result += 'Wenn eine der Konfigurationen die falsche Projekt-ID hat,\n';
                result += 'aktualisieren Sie sie auf die korrekte Projekt-ID: ' + EXPECTED_PROJECT_ID;
                
                showResult('fix-result', result, 'info');
                
            } catch (error) {
                console.error('Alternative config test failed:', error);
                showResult('fix-result', `‚ùå Alternative Konfigurations-Test fehlgeschlagen:\n${error.message}`, 'error');
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const statusEl = document.getElementById('overall-status');
                const contentEl = document.getElementById('status-content');
                
                contentEl.innerHTML = 'üîÑ Initialisiere Firebase-Diagnose...';
                statusEl.style.display = 'block';
                
                await waitForFirebase();
                
                // Quick initial check
                const app = firebase.app();
                const projectId = app.options.projectId;
                const isCorrectProject = projectId === EXPECTED_PROJECT_ID;
                
                if (isCorrectProject) {
                    contentEl.innerHTML = `
                        <div class="result success">
                            ‚úÖ Firebase-Diagnose bereit<br>
                            ‚Ä¢ Projekt-ID: ${projectId} ‚úÖ<br>
                            ‚Ä¢ System scheint korrekt konfiguriert zu sein<br><br>
                            F√ºhren Sie die einzelnen Tests durch, um Details zu erhalten.
                        </div>
                    `;
                } else {
                    contentEl.innerHTML = `
                        <div class="result warning">
                            ‚ö†Ô∏è PROBLEM ERKANNT!<br>
                            ‚Ä¢ Aktuelle Projekt-ID: ${projectId}<br>
                            ‚Ä¢ Erwartete Projekt-ID: ${EXPECTED_PROJECT_ID}<br>
                            ‚Ä¢ Das System greift auf die falsche Datenbank zu!<br><br>
                            üõ†Ô∏è Verwenden Sie die Tools unten zur Diagnose und Reparatur.
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Initialization failed:', error);
                document.getElementById('status-content').innerHTML = `
                    <div class="result error">
                        ‚ùå Initialisierung fehlgeschlagen: ${error.message}
                    </div>
                `;
            }
        });
    </script>
</body>
</html>